<!doctype html>
<!-- build: calc.industry4.co | v0.7.6.2 | 2026-02-05 |  -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex" />
  <meta name="app-version" content="v0.7.6.2" />
  <title>Industrial Digitalization Calculator</title>
  <style>
    :root { --max: 40; } /* 20 questions * 2 points */
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #f7f7f8;
      color: #111;
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 28px 16px 60px; }
    header {
      background: white;
      border: 1px solid #e6e6e8;
      border-radius: 14px;
      padding: 18px 18px 14px;
      margin-bottom: 16px;
    }
    header h1 { margin: 0 0 6px; font-size: 22px; }
    header p { margin: 0; color: #444; line-height: 1.35; }

    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 16px; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: white;
      border: 1px solid #e6e6e8;
      border-radius: 14px;
      padding: 16px;
    }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    .muted { color: #555; font-size: 13px; line-height: 1.35; }
    .pill {
      display: inline-block;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #efeff1;
      color: #333;
      margin: 8px 8px 0 0;
    }

    .progress {
      width: 100%;
      height: 10px;
      background: #efeff1;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress > div { height: 100%; width: 0%; background: #111; }

    details.section { border: 1px solid #efeff1; border-radius: 12px; padding: 10px 12px; margin: 10px 0; }
    details.section summary { cursor: pointer; font-weight: 650; list-style: none; }
    details.section summary::-webkit-details-marker { display: none; }
    .q { padding: 10px 0; border-top: 1px solid #f1f1f3; }
    .q:first-of-type { border-top: 0; }
    .q label.title { display: block; font-weight: 600; margin-bottom: 8px; }
    .choices { display: flex; flex-wrap: wrap; gap: 10px; }
    .choice {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #e6e6e8;
      border-radius: 10px;
      padding: 8px 10px;
      background: #fff;
      cursor: pointer;
      user-select: none;
    }
    .choice input { margin: 0; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 14px; }
    button {
      border: 1px solid #111;
      background: #111;
      color: white;
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 650;
    }
    button.secondary { background: white; color: #111; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .big { font-size: 28px; font-weight: 800; margin: 2px 0 6px; }
    .level { font-size: 13px; color: #333; }
    .divider { height: 1px; background: #efeff1; margin: 14px 0; }

    .bars { display: grid; gap: 10px; margin-top: 8px; }
    .barrow { display: grid; grid-template-columns: 160px 1fr 52px; gap: 10px; align-items: center; }
    @media (max-width: 520px) { .barrow { grid-template-columns: 1fr; } }
    .barlabel { font-size: 13px; color: #222; }
    .bartrack { height: 10px; background: #efeff1; border-radius: 999px; overflow: hidden; }
    .barfill { height: 100%; width: 0%; background: #111; }
    .barpct { font-size: 12px; color: #333; text-align: right; }

    .note { font-size: 12px; color: #555; line-height: 1.35; white-space: pre-line; }
    .foot { margin-top: 12px; font-size: 12px; color: #666; }
    .req { color: #b00020; font-size: 16px; display: none; margin-top: 8px; }

    .banner {
      border: 1px solid #efeff1;
      border-radius: 12px;
      padding: 12px;
      background: #fafafb;
      margin-top: 12px;
    }
    .banner h3 { margin: 0 0 6px; font-size: 14px; }
    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid #e6e6e8;
      background: #fff;
      cursor: pointer;
      user-select: none;
      font-size: 13px;
    }
    .tag input { margin: 0; }
    .small { font-size: 12px; color: #666; line-height: 1.35; margin-top: 6px; }
    .warn { color: #b00020; font-size: 16px; display: none; margin-top: 8px; }
  
    /* Progressive disclosure states */
    details.section.locked {
      opacity: 0.55;
      background: #fafafb;
    }
    details.section.locked summary { cursor: not-allowed; }
    details.section.locked .q { pointer-events: none; }
    details.section.locked input { pointer-events: none; }
    details.section.locked .choice { cursor: not-allowed; }

    details.section.active {
      border-color: #d8d8dc;
    }
    details.section.completed {
      opacity: 0.90;
    }

  
    /* Button-like radio choices (no native radio dot) */
    .choice input[type="radio"],
    .tag input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 0;
      height: 0;
    }

    .choice, .tag {
      position: relative;
      transition: background 120ms ease, border-color 120ms ease, color 120ms ease, transform 120ms ease;
    }

    /* Hover (only for interactive states) */
    details.section:not(.locked) .choice:hover,
    .tag:hover {
      border-color: #cfcfd6;
      transform: translateY(-1px);
    }

    /* Selected state class set by JS */
    .choice.selected,
    .tag.selected {
      background: #111;
      border-color: #111;
      color: #fff;
    }

    details.section:not(.locked) .choice.selected:hover,
    .tag.selected:hover {
      border-color: #111;
      transform: none;
    }

  
  @media print {
    body {
      background: white !important;
      color: black !important;
    }

    header,
    main,
    .progress,
    .pill,
    .actions {
      display: none !important;
    }

    .grid {
      display: block !important;
    }

    .results-card {
      width: 100% !important;
      border: none !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      padding: 0 !important;
    }

    .results-card h2 {
      margin-top: 24px;
    }

    .bars .bartrack {
      background: #ccc !important;
    }

    .barfill {
      background: #000 !important;
    }
  }


@media print {

  /* 1. Hide everything */
  body * {
    visibility: hidden !important;
  }

  /* 2. Allow only Results */
  #results,
  #results * {
    visibility: visible !important;
  }

  /* 3. Exclude inline AI helper explicitly */
  #aiInlineHelp,
  #aiInlineHelp * {
    display: none !important;
    visibility: hidden !important;
  }

  /* 4. Remove buttons and interactive UI inside Results */
  #results button,
  #results .no-print,
  zapier-interfaces-chatbot-embed {
    display: none !important;
  }

  /* 5. Layout cleanup */
  #results {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    max-width: none;
    padding: 0;
    margin: 0;
    background: white;
  }

  body {
    background: white !important;
  }
}

@keyframes shake {
  0%   { transform: translateX(0); }
  20%  { transform: translateX(-4px); }
  40%  { transform: translateX(4px); }
  60%  { transform: translateX(-4px); }
  80%  { transform: translateX(4px); }
  100% { transform: translateX(0); }
}

.shake {
  animation: shake 0.4s ease-in-out;
}

</style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GN2KYF1EF5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GN2KYF1EF5', { anonymize_ip: true });

  function track(event, params = {}) {
    if (window.gtag) {
      gtag('event', event, params);
    }
  }
</script>

<script>
  /* helpers */
  function showAndShake(el) {
    if (!el) return;

    el.style.display = "block";

    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      el.classList.add("shake");
      setTimeout(() => el.classList.remove("shake"), 400);
    }
  }
</script>

</head>

<body>
  <div class="wrap">
    <header>
      <h1>Industrial Digitalization Calculator</h1>
      <p>Answer 20 short questions to estimate your industrial digital maturity across production, maintenance, quality, warehouse, energy, safety, and data integration.</p>

      <div class="progress" aria-label="Progress">
        <div id="progressFill"></div>
      </div>
      <div class="muted" id="progressText" style="margin-top:8px;">0 of 20 answered</div>
      <div>
        <span class="pill">No registration</span>
        <span class="pill">5 minutes</span>
        <span class="pill">Industrial focus</span>
      </div>
    </header>

    <div class="grid">
      <main class="card" aria-label="Questionnaire">
        <h2>Questionnaire</h2>
        <p class="muted">Choose one answer per question. You can calculate anytime.</p>
		
		      <div class="banner" aria-label="Production type selector">
        <h3>Select your production type</h3>
        <div class="row">
          <label class="tag"><input type="radio" name="ptype" value="discrete" /> Discrete</label>
          <label class="tag"><input type="radio" name="ptype" value="process" /> Process</label>
          <label class="tag"><input type="radio" name="ptype" value="not_sure" /> Not sure</label>
        </div>
                <div class="warn" id="ptypeWarn">Select a production type to calculate recommendations.</div>
      </div>
		
        <div class="req" id="reqMsg">Please answer at least one question to calculate.</div>

        <!-- SECTION 1 -->
        <details class="section" data-section="1" open>
		
          <summary>1) Production Planning and Scheduling</summary>

          <div class="q" data-domain="planning">
            <label class="title">1. Is production planning managed in a dedicated system (ERP, APS, MES) rather than spreadsheets</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q1" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q1" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q1" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="planning">
            <label class="title">2. Is there digital shop-floor scheduling and dispatching by workshops and shifts</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q2" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q2" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q2" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="planning">
            <label class="title">3. Are actual output and downtime recorded in a system on the same day</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q3" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q3" value="1" /> Sometimes</label>
              <label class="choice"><input type="radio" name="q3" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 2 -->
        <details class="section" data-section="2">
          <summary>2) Equipment and Maintenance (EAM / CMMS)</summary>

          <div class="q" data-domain="maintenance">
            <label class="title">4. Is there a digital asset register with equipment passports, criticality and maintenance history</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q4" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q4" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q4" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="maintenance">
            <label class="title">5. Are maintenance requests created and closed in a system rather than via calls or messages</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q5" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q5" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q5" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="maintenance">
            <label class="title">6. How is maintenance primarily performed</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q6" value="2" /> Scheduled (preventive)</label>
              <label class="choice"><input type="radio" name="q6" value="2" /> Condition-based</label>
              <label class="choice"><input type="radio" name="q6" value="0" /> Mostly after breakdowns</label>
            </div>
          </div>

          <div class="q" data-domain="maintenance">
            <label class="title">7. Are equipment parameters collected automatically (sensors, machines, production lines)</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q7" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q7" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q7" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 3 -->
        <details class="section" data-section="3">
          <summary>3) Quality and Traceability</summary>

          <div class="q" data-domain="quality">
            <label class="title">8. Is quality control managed digitally (inspection plans, quality records)</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q8" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q8" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q8" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="quality">
            <label class="title">9. Can a production batch be traced from raw materials to shipment within one day</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q9" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q9" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q9" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="quality">
            <label class="title">10. Are defect causes and corrective actions recorded in a system</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q10" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q10" value="1" /> Sometimes</label>
              <label class="choice"><input type="radio" name="q10" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 4 -->
        <details class="section" data-section="4">
          <summary>4) Warehouse, Materials and Procurement</summary>

          <div class="q" data-domain="warehouse">
            <label class="title">11. Is inventory of raw materials and finished goods managed in a system with up-to-date balances</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q11" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q11" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q11" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="warehouse">
            <label class="title">12. Are barcodes or RFID used in warehouse or production operations</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q12" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q12" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q12" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="warehouse">
            <label class="title">13. Are material requests and purchase approvals processed digitally rather than via emails or chats</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q13" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q13" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q13" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 5 -->
        <details class="section" data-section="5">
          <summary>5) Energy and Utilities</summary>

          <div class="q" data-domain="energy">
            <label class="title">14. Is energy and utilities consumption (electricity, gas, water, steam) automatically measured</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q14" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q14" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q14" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="energy">
            <label class="title">15. Are energy efficiency indicators and losses calculated on a regular basis</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q15" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q15" value="1" /> Sometimes</label>
              <label class="choice"><input type="radio" name="q15" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 6 -->
        <details class="section" data-section="6">
          <summary>6) Safety and Compliance</summary>

          <div class="q" data-domain="safety">
            <label class="title">16. Are safety trainings, permits and work authorizations managed digitally</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q16" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q16" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q16" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="safety">
            <label class="title">17. Are there defined cybersecurity practices for operational technology (OT, ICS)</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q17" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q17" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q17" value="0" /> No</label>
            </div>
          </div>
        </details>

        <!-- SECTION 7 -->
        <details class="section" data-section="7">
          <summary>7) Data and Integration</summary>

          <div class="q" data-domain="data">
            <label class="title">18. Are core systems integrated (for example ERP, warehouse, production, maintenance)</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q18" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q18" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q18" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="data">
            <label class="title">19. Are there unified production KPIs (OEE, downtime, output) trusted by both shop floor and management</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q19" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q19" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q19" value="0" /> No</label>
            </div>
          </div>

          <div class="q" data-domain="data">
            <label class="title">20. Is management reporting generated automatically</label>
            <div class="choices">
              <label class="choice"><input type="radio" name="q20" value="2" /> Yes</label>
              <label class="choice"><input type="radio" name="q20" value="1" /> Partially</label>
              <label class="choice"><input type="radio" name="q20" value="0" /> No</label>
            </div>
          </div>
        </details>

        <div class="actions">
          <button id="calcBtn">Calculate</button>
          <button class="secondary" id="resetBtn" type="button">Reset</button>
          
        </div>

        <div class="foot">
          Assessment focuses on operational discipline, data reliability, and process ownership rather than tool names or technology labels.</div>
      </main>

      <aside class="card" aria-label="Results" id="results">
        <h2>Results</h2>
        <div class="muted">Your score updates after you click Calculate. You can still change answers and recalculate.</div>

        <div class="divider"></div>

        <div class="big" id="overallScore">0%</div>
        <div class="level" id="overallLevel">Answer questions and select production type to get your roadmap.</div>

        <div class="divider"></div>

        <h2 style="margin-top:0;">Domain breakdown</h2>
        <div class="bars" id="bars"></div>

        <div class="divider"></div>

        <h2 style="margin-top:0;" id="roadmapTitle">Recommended next steps</h2>
        <div class="note" id="nextSteps">After calculation, you will see a production-type roadmap based on blockers and weakest domains.</div>

<div id="resultsActions"
     style="display:none;">

  <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
   <button id="aiDiscussBtn" class="primary" style="width:100%;"> Discuss your results with AI</button>
    <button id="copyBtn" class="secondary" type="button">Copy</button>
    <button id="printBtn" class="secondary" type="button">Print</button>
    <button id="contactExpertBtn" class="primary" type="button">Contact expert</button>
  </div>
</div>

<div id="aiInlineHelp"
     style="display:none; margin-top:14px; padding:14px;
            border:1px solid #e6e6e8; border-radius:12px;
            background:#fafafb;">
			

  <div style="font-weight:600; margin-bottom:6px;">
    âœ“ AI assistant is ready
  </div>

  <div class="muted" style="line-height:1.4;">
    The discussion continues in the chat icon at the bottom-right corner.
    <br><br>
    <strong>How to proceed:</strong><br>
    1. Click <em>Copy</em><br>
    2. Open the AI chat<br>
    3. Paste results and explore your digital transformation
  </div>
</div>


</aside>

        
    </div>
  </div>

  <script>
    const MAX_TOTAL = 40; // 20 * 2

    const domains = [
      { key: "planning", name: "Planning and Scheduling", max: 6 },     // q1-3
      { key: "maintenance", name: "Maintenance (EAM/CMMS)", max: 8 },   // q4-7
      { key: "quality", name: "Quality and Traceability", max: 6 },     // q8-10
      { key: "warehouse", name: "Warehouse and Procurement", max: 6 },  // q11-13
      { key: "energy", name: "Energy and Utilities", max: 4 },          // q14-15
      { key: "safety", name: "Safety and OT Security", max: 4 },        // q16-17
      { key: "data", name: "Data and Integration", max: 6 },            // q18-20
    ];

    const progressFill = document.getElementById("progressFill");
    const progressText = document.getElementById("progressText");
    const overallScoreEl = document.getElementById("overallScore");
    const overallLevelEl = document.getElementById("overallLevel");
    const barsEl = document.getElementById("bars");
    const nextStepsEl = document.getElementById("nextSteps");
    const reqMsg = document.getElementById("reqMsg");
    const ptypeWarn = document.getElementById("ptypeWarn");

    const calcBtn = document.getElementById("calcBtn");
    const resetBtn = document.getElementById("resetBtn");
	
	

    function getProductionTypeRaw() {
      const picked = document.querySelector('input[name="ptype"]:checked');
      return picked ? picked.value : "";
    }

    function getProductionTypeEffective() {
      const raw = getProductionTypeRaw();
      if (!raw) return "";
      return raw === "process" ? "process" : "discrete"; // not_sure -> discrete
    }

    function getAnsweredCount() {
      let answered = 0;
      for (let i = 1; i <= 20; i++) {
        const picked = document.querySelector(`input[name="q${i}"]:checked`);
        if (picked) answered++;
      }
      return answered;
    }

    function updateProgress() {
      const answered = getAnsweredCount();
      const pct = Math.round((answered / 20) * 100);
      progressFill.style.width = pct + "%";
      progressText.textContent = `${answered} of 20 answered`;
    }

    function getScores() {
      const domainScores = Object.fromEntries(domains.map(d => [d.key, 0]));
      let total = 0;

      document.querySelectorAll(".q").forEach(q => {
        const domain = q.getAttribute("data-domain");
        const input = q.querySelector("input[type=radio]:checked");
        if (!input) return;

        const val = Number(input.value);
        domainScores[domain] += val;
        total += val;
      });

      return { total, domainScores };
    }

    function pctOf(score, max) {
      if (!max) return 0;
      return Math.round((score / max) * 100);
    }

    function overallLevelFromPercent(p) {
      if (p <= 30) return "Initial level - digitalization is fragmented";
      if (p <= 60) return "Basic level - foundation exists, scale is limited";
      if (p <= 80) return "Advanced level - consistent practices, room to integrate and optimize";
      return "High level - strong digital operations and governance";
    }

    function renderBars(domainScores) {
      barsEl.innerHTML = "";
      domains.forEach(d => {
        const score = domainScores[d.key];
        const pct = pctOf(score, d.max);

        const row = document.createElement("div");
        row.className = "barrow";

        const label = document.createElement("div");
        label.className = "barlabel";
        label.textContent = d.name;

        const track = document.createElement("div");
        track.className = "bartrack";

        const fill = document.createElement("div");
        fill.className = "barfill";
        fill.style.width = Math.max(0, Math.min(100, pct)) + "%";
        track.appendChild(fill);

        const pctEl = document.createElement("div");
        pctEl.className = "barpct";
        pctEl.textContent = pct + "%";

        row.appendChild(label);
        row.appendChild(track);
        row.appendChild(pctEl);
        barsEl.appendChild(row);
      });
    }

    // Roadmap logic - production-type aware
    // Not sure is treated as Discrete (effective type).
    function buildRoadmapText(domainScores, effectiveType) {
      const planningPct = pctOf(domainScores.planning, 6);
      const maintenancePct = pctOf(domainScores.maintenance, 8);
      const qualityPct = pctOf(domainScores.quality, 6);
      const warehousePct = pctOf(domainScores.warehouse, 6);
      const energyPct = pctOf(domainScores.energy, 4);
      const safetyPct = pctOf(domainScores.safety, 4);
      const dataPct = pctOf(domainScores.data, 6);

      const q3 = document.querySelector('input[name="q3"]:checked')?.value;   // fact capture
      const q6 = document.querySelector('input[name="q6"]:checked')?.value;   // maintenance mode (0 means breakdowns)
      const q19 = document.querySelector('input[name="q19"]:checked')?.value; // trusted KPIs

      const blockers = [];

      // Blocker A - no reliable production fact capture
      if (q3 === "0" || planningPct < 40) {
        blockers.push({
          key: "fact",
          title: "Step 1 - Establish reliable production fact capture",
          why: "Without same-day output and downtime capture, planning, OEE, and improvement actions are built on guesses.",
          actions: [
            "Record output and downtime on the same shift - same day",
            "Standardize downtime reasons (short list, clear definitions)",
            "Assign data ownership per shift (who records and who validates)"
          ]
        });
      }

      // Blocker B - reactive maintenance
      if (q6 === "0") {
        blockers.push({
          key: "maint",
          title: "Step 1 - Stabilize maintenance basics (stop living in breakdown mode)",
          why: "Breakdown-driven maintenance will destroy throughput as soon as you push utilization.",
          actions: [
            "Create an equipment register with criticality and history",
            "Move work requests and closures into one CMMS workflow",
            "Start preventive routines for the critical 20% of assets"
          ]
        });
      }

      // Blocker C - no trust in KPIs / weak data governance
      if (q19 === "0" || dataPct < 40) {
        blockers.push({
          key: "kpi",
          title: "Step 1 - Fix KPI trust and data governance",
          why: "If shop floor and management do not trust the same numbers, dashboards only create debates.",
          actions: [
            "Define 5 to 7 core KPIs and calculation rules",
            "Remove manual edits from the reporting chain",
            "Set a single source of truth per KPI (system, owner, cadence)"
          ]
        });
      }

      // If blockers exist, return first two blockers (or one blocker + next best step)
      if (blockers.length > 0) {
        const lines = [];
        const selected = blockers.slice(0, 2);

        selected.forEach((b, idx) => {
          lines.push(`${b.title}`);
          lines.push(`Why: ${b.why}`);
          lines.push(`Do this:`);
          b.actions.forEach(a => lines.push(`- ${a}`));
          if (idx < selected.length - 1) lines.push("");
        });

        // Add a "Step 2" if only one blocker and we have a clear next move by type
        if (selected.length === 1) {
          const next = nextBestNonBlocker(domainScores, effectiveType);
          if (next) {
            lines.push("");
            lines.push(`${next.title}`);
            lines.push(`Why: ${next.why}`);
            lines.push(`Do this:`);
            next.actions.forEach(a => lines.push(`- ${a}`));
          }
        }

        return lines.join("\n");
      }

      // No blockers - pick roadmap based on type and weakest domains
      const next = nextBestNonBlocker(domainScores, effectiveType);
      const second = secondBestNonBlocker(domainScores, effectiveType, next?.key);

      const out = [];
      if (next) {
        out.push(next.title);
        out.push(`Why: ${next.why}`);
        out.push("Do this:");
        next.actions.forEach(a => out.push(`- ${a}`));
      }

      if (second) {
        out.push("");
        out.push(second.title);
        out.push(`Why: ${second.why}`);
        out.push("Do this:");
        second.actions.forEach(a => out.push(`- ${a}`));
      }

      // If very mature, add an optimization step
      const avgPct = Math.round((planningPct + maintenancePct + qualityPct + warehousePct + energyPct + safetyPct + dataPct) / 7);
      if (avgPct >= 70) {
        out.push("");
        if (effectiveType === "process") {
          out.push("Step 3 - Optimize yield, energy, and compliance using closed-loop routines");
          out.push("Why: With stable data and workflows, the next gains come from reducing variability and losses.");
          out.push("Do this:");
          out.push("- Track yield and energy per batch or campaign as weekly KPIs");
          out.push("- Run deviation reviews (recipe, parameters, quality) with CAPA discipline");
          out.push("- Expand monitoring to critical units and automate alerts for deviations");
        } else {
          out.push("Step 3 - Optimize throughput using constraints, setups, and reliable OEE routines");
          out.push("Why: With stable data and workflows, the next gains come from reducing hidden time losses.");
          out.push("Do this:");
          out.push("- Focus on the constraint work centers and reduce changeover time");
          out.push("- Use downtime pareto with owners and actions per top reasons");
          out.push("- Expand machine connectivity for critical equipment and automate alerts");
        }
      }

      return out.length ? out.join("\n") : "Answer more questions to get tailored recommendations.";
    }

    function nextBestNonBlocker(domainScores, effectiveType) {
      const pPlanning = pctOf(domainScores.planning, 6);
      const pMaintenance = pctOf(domainScores.maintenance, 8);
      const pQuality = pctOf(domainScores.quality, 6);
      const pWarehouse = pctOf(domainScores.warehouse, 6);
      const pEnergy = pctOf(domainScores.energy, 4);
      const pSafety = pctOf(domainScores.safety, 4);
      const pData = pctOf(domainScores.data, 6);

      // Type-specific weighting for prioritization
      // Discrete - planning, maintenance, warehouse, data
      // Process - quality, energy, maintenance, data
      const candidates = [
        { key: "planning", pct: pPlanning, weight: (effectiveType === "process" ? 0.8 : 1.2) },
        { key: "maintenance", pct: pMaintenance, weight: (effectiveType === "process" ? 1.2 : 1.2) },
        { key: "quality", pct: pQuality, weight: (effectiveType === "process" ? 1.3 : 1.0) },
        { key: "warehouse", pct: pWarehouse, weight: (effectiveType === "process" ? 0.9 : 1.1) },
        { key: "energy", pct: pEnergy, weight: (effectiveType === "process" ? 1.3 : 0.8) },
        { key: "safety", pct: pSafety, weight: 0.9 },
        { key: "data", pct: pData, weight: 1.1 },
      ];

      // pick lowest (pct * inverse weight)
      candidates.sort((a, b) => (a.pct / a.weight) - (b.pct / b.weight));
      const top = candidates[0]?.key;

      return roadmapForDomain(top, effectiveType);
    }

    function secondBestNonBlocker(domainScores, effectiveType, excludeKey) {
      const pMap = {
        planning: pctOf(domainScores.planning, 6),
        maintenance: pctOf(domainScores.maintenance, 8),
        quality: pctOf(domainScores.quality, 6),
        warehouse: pctOf(domainScores.warehouse, 6),
        energy: pctOf(domainScores.energy, 4),
        safety: pctOf(domainScores.safety, 4),
        data: pctOf(domainScores.data, 6),
      };

      const weights = (effectiveType === "process")
        ? { planning: 0.8, maintenance: 1.2, quality: 1.3, warehouse: 0.9, energy: 1.3, safety: 0.9, data: 1.1 }
        : { planning: 1.2, maintenance: 1.2, quality: 1.0, warehouse: 1.1, energy: 0.8, safety: 0.9, data: 1.1 };

      const keys = Object.keys(pMap).filter(k => k !== excludeKey);
      keys.sort((a, b) => (pMap[a] / weights[a]) - (pMap[b] / weights[b]));

      const top2 = keys[0];
      return roadmapForDomain(top2, effectiveType);
    }

    function roadmapForDomain(domainKey, effectiveType) {
      if (!domainKey) return null;

      if (effectiveType === "process") {
        if (domainKey === "quality") {
          return {
            key: "quality",
            title: "Step 1 - Process: lock down batch quality and deviation control",
            why: "In process industry, variability and deviations hit yield, compliance, and rework cost fast.",
            actions: [
              "Digitize inspection and batch records where they actually happen",
              "Record deviations and corrective actions (CAPA style, simple but mandatory)",
              "Tie nonconformances to batch, recipe, and process stage"
            ]
          };
        }
        if (domainKey === "energy") {
          return {
            key: "energy",
            title: "Step 1 - Process: make energy visible and actionable",
            why: "Energy is often a top cost driver in process operations and is measurable early.",
            actions: [
              "Meter major consumers (electricity, steam, gas) at unit or line level",
              "Track energy intensity per product or batch weekly",
              "Investigate losses (peaks, leaks, standby) with owners and actions"
            ]
          };
        }
        if (domainKey === "planning") {
          return {
            key: "planning",
            title: "Step 1 - Process: improve batch and campaign planning discipline",
            why: "Better sequencing and fewer unstable transitions reduce scrap, downtime, and quality risk.",
            actions: [
              "Plan by batches and campaigns in a consistent system, not ad hoc files",
              "Standardize changeover and transition steps (who, when, checklist)",
              "Record stops and transitions as events with reasons"
            ]
          };
        }
        if (domainKey === "maintenance") {
          return {
            key: "maintenance",
            title: "Step 1 - Process: prioritize reliability by risk and critical loops",
            why: "Unplanned failures in process units cascade into safety, quality, and large production losses.",
            actions: [
              "Classify critical assets by risk, not by loudest complaint",
              "Run CMMS workflow for requests, approvals, and closures",
              "Start condition monitoring on critical equipment and controls"
            ]
          };
        }
        if (domainKey === "data") {
          return {
            key: "data",
            title: "Step 1 - Process: integrate around batch, deviations, and core KPIs",
            why: "Integration only matters when it closes the loop between batches, quality, and actions.",
            actions: [
              "Define single sources for yield, quality, and energy KPIs",
              "Connect key events between systems (batch start, batch end, deviation, release)",
              "Automate reporting with frozen definitions and ownership"
            ]
          };
        }
        if (domainKey === "warehouse") {
          return {
            key: "warehouse",
            title: "Step 1 - Process: stabilize materials and lot traceability",
            why: "Lot mistakes and inventory drift break traceability and quality compliance.",
            actions: [
              "Make system inventory match reality for critical materials first",
              "Use barcode or scanning for receiving, issue, and consumption",
              "Tie material lots to batches in records"
            ]
          };
        }
        // safety fallback
        return {
          key: "safety",
          title: "Step 1 - Process: digitize permits and tighten OT security basics",
          why: "Safety routines and OT security reduce risk and enable stable operations.",
          actions: [
            "Digitize permits and work authorizations for repeatability",
            "Implement OT access control and change management basics",
            "Track safety events and near misses consistently"
          ]
        };
      }

      // Discrete roadmap (also used for Not sure)
      if (domainKey === "planning") {
        return {
          key: "planning",
          title: "Step 1 - Discrete: strengthen dispatching and daily production control",
          why: "Discrete operations win or lose on queues, setups, and reaction speed at the shop floor.",
          actions: [
            "Run shift-level dispatching linked to orders and work centers",
            "Record downtime and output with standardized reasons",
            "Review top downtime reasons weekly with owners and actions"
          ]
        };
      }
      if (domainKey === "maintenance") {
        return {
          key: "maintenance",
          title: "Step 1 - Discrete: stabilize maintenance workflow and reduce unplanned stops",
          why: "Throughput collapses when the constraint work centers are unreliable.",
          actions: [
            "Build an asset register with criticality and maintenance history",
            "Move requests and closures into CMMS with basic SLA",
            "Start condition monitoring on the constraint machines first"
          ]
        };
      }
      if (domainKey === "warehouse") {
        return {
          key: "warehouse",
          title: "Step 1 - Discrete: fix inventory accuracy and material issuing discipline",
          why: "If materials are not reliable, schedules become fiction and WIP grows.",
          actions: [
            "Stabilize system inventory for A-class items",
            "Implement barcode for receiving, picking, and issue to production",
            "Tie material issue to orders or jobs to reduce silent losses"
          ]
        };
      }
      if (domainKey === "quality") {
        return {
          key: "quality",
          title: "Step 1 - Discrete: digitize quality records and close the loop on defects",
          why: "In discrete manufacturing, recurring defects are usually process drift that nobody owns end-to-end.",
          actions: [
            "Digitize inspection records at the operation or work center",
            "Record defect causes and corrective actions consistently",
            "Link defects to operations, machines, and shifts for repeatability analysis"
          ]
        };
      }
      if (domainKey === "data") {
        return {
          key: "data",
          title: "Step 1 - Discrete: unify KPIs and integrate core systems around orders and equipment",
          why: "You cannot improve what you cannot measure consistently across shifts and departments.",
          actions: [
            "Define 5 to 7 KPIs (OEE, downtime, output, schedule adherence) with rules",
            "Connect key events between systems (job start, job end, stop, scrap)",
            "Automate reporting so numbers do not change after the shift ends"
          ]
        };
      }
      if (domainKey === "energy") {
        return {
          key: "energy",
          title: "Step 1 - Discrete: start energy metering after production fact is stable",
          why: "Energy savings are real, but they come after you trust production and downtime data.",
          actions: [
            "Meter major consumers and detect peaks and standby losses",
            "Track energy per part or per shift for key lines",
            "Assign owners for top loss drivers"
          ]
        };
      }
      // safety fallback
      return {
        key: "safety",
        title: "Step 1 - Discrete: digitize safety workflows and formalize OT access rules",
        why: "Basic safety and OT governance prevent incidents and reduce chaos during changes.",
        actions: [
          "Digitize permits and work authorizations",
          "Implement OT access control and change logging",
          "Track incidents and corrective actions"
        ]
      };
    }

    
    function sanitizeRoadmapText(text) {
      // Remove "Step N - " prefixes from any line (keeps the content, removes numbering).
      return String(text || "")
        .replace(/^Step\s+\d+\s*-\s*/gm, "")
        .replace(/^(Discrete|Process):\s*/gmi, "");
    }


    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function formatRoadmapToHTML(text) {
      const clean = sanitizeRoadmapText(text);
      const blocks = clean.split(/\n\s*\n/).map(b => b.trim()).filter(Boolean);

      const out = [];

      blocks.forEach((block, blockIdx) => {
        const lines = block.split(/\n/).map(l => l.trim()).filter(Boolean);
        if (!lines.length) return;

        const title = lines[0];
        out.push(`<div><strong>${escapeHtml(title)}</strong></div>`);

        let inList = false;

        for (let i = 1; i < lines.length; i++) {
          const line = lines[i];

          if (line.startsWith("- ")) {
            if (!inList) {
              out.push("<ul style=\"margin:8px 0 10px 18px; padding:0;\">");
              inList = true;
            }
            out.push(`<li>${escapeHtml(line.slice(2))}</li>`);
            continue;
          }

          if (inList) {
            out.push("</ul>");
            inList = false;
          }

          if (line.startsWith("Why:")) {
            out.push(`<div class=\"muted\" style=\"margin-top:6px;\">${escapeHtml(line.slice(4).trim())}</div>`);
            continue;
          }

          if (line.toLowerCase() === "do this:" || line.startsWith("Do this:")) {
            // Hide "Do this:" label in UI
            continue;
          }

          out.push(`<div>${escapeHtml(line)}</div>`);
        }

        if (inList) out.push("</ul>");

        if (blockIdx < blocks.length - 1) {
          out.push('<div style="height:10px;"></div>');
        }
      });

      return out.join("");
    }

    function syncSelectedLabels() {
      // Production type buttons
      document.querySelectorAll('label.tag').forEach(lbl => {
        const inp = lbl.querySelector('input[type="radio"]');
        if (!inp) return;
        lbl.classList.toggle('selected', inp.checked);
      });

      // Answer choices
      document.querySelectorAll('label.choice').forEach(lbl => {
        const inp = lbl.querySelector('input[type="radio"]');
        if (!inp) return;
        lbl.classList.toggle('selected', inp.checked);
      });
    }

function calculate() {
      const answered = getAnsweredCount();
      const effectiveType = getProductionTypeEffective();

		if (!answered) {
		  reqMsg.style.display = "block";
		
		  if (typeof reqMsg.scrollIntoView === "function") {
		    reqMsg.scrollIntoView({
		      behavior: "smooth",
		      block: "center"
		    });
		  }
		  
		    setTimeout(() => {
			    reqMsg.classList.add("shake");
			
			    setTimeout(() => {
			      reqMsg.classList.remove("shake");
			    }, 400);
			
			  }, 300);
					
		  return;
		}


      if (!effectiveType) {
        ptypeWarn.style.display = "block";
        // Scroll to production type warning
        const warnEl = document.getElementById("ptypeWarn");
        if (warnEl && typeof warnEl.scrollIntoView === "function") {
          warnEl.scrollIntoView({ behavior: "smooth", block: "center" });
        }
		
				    setTimeout(() => {
			    reqMsg.classList.add("shake");
			
			    setTimeout(() => {
			      ptypeWarn.classList.remove("shake");
			    }, 400);
			
			  }, 300);
		
        return;
      }
      ptypeWarn.style.display = "none";
      const ra = document.getElementById("resultActions"); if (ra) ra.style.display = "none";
      updateProgressiveDisclosure();
      syncSelectedLabels();

      const { total, domainScores } = getScores();
      const pct = Math.round((total / MAX_TOTAL) * 100);

      overallScoreEl.textContent = pct + "%";
      overallLevelEl.textContent = overallLevelFromPercent(pct);

      renderBars(domainScores);
      // Persist calculated results for copy/print/zapier share
      const maturity = overallLevelFromPercent(pct);
      const roadmapText = sanitizeRoadmapText(buildRoadmapText(domainScores, effectiveType));
      window.assessmentState.productionType = effectiveType;
      window.assessmentState.overallScore = pct;
      window.assessmentState.maturityLevel = maturity;
      window.assessmentState.domainScores = domainScores;
      window.assessmentState.answersRaw = buildAnswersRaw();
      window.assessmentState.roadmapText = roadmapText;
		try {
		  localStorage.setItem(
		    'i4_calc_result',
		    JSON.stringify(window.assessmentState)
		  );
		} catch (e) {
		  console.warn('Failed to persist assessment state', e);
		}


      
     const roadmapTitleEl = document.getElementById("roadmapTitle");
		if (roadmapTitleEl) {
	 	 roadmapTitleEl.textContent =
	   	 effectiveType === "process"
	      ? "Recommended next steps for Process industry"
	      : "Recommended next steps for Discrete manufacturing";
			}

      const roadmap = buildRoadmapText(domainScores, effectiveType);
      nextStepsEl.innerHTML = formatRoadmapToHTML(roadmap);
	  if (nextStepsEl) {
		  nextStepsEl.innerHTML = formatRoadmapToHTML(roadmap);
		}
      document.getElementById("resultActions").style.display = "flex";

      // Jump to Results (mobile-friendly)
      const resultsEl = document.getElementById("results");
      if (resultsEl && typeof resultsEl.scrollIntoView === "function") {
        resultsEl.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function resetAll() {
      requestAnimationFrame(() => {
        try {
          window.scrollTo({ top: 0, left: 0, behavior: "smooth" });
        } catch (e) {
          window.scrollTo(0, 0);
        }
      });
      setTimeout(() => window.scrollTo(0, 0), 200);
      document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);
      updateProgress();
    updateProgressiveDisclosure();
      syncSelectedLabels();
overallScoreEl.textContent = "0%";
      overallLevelEl.textContent = "Answer questions and select production type to get your roadmap.";

      // Clear roadmap header and text
      const roadmapTitleEl = document.getElementById("roadmapTitle");
	  const aiInline = document.getElementById('aiInlineHelp');
	  if (aiInline) aiInline.style.display = 'none';
      if (roadmapTitleEl) roadmapTitleEl.textContent = "Recommended next steps";
      nextStepsEl.innerHTML = "After calculation, you will see a production-type roadmap based on blockers and weakest domains.";
      barsEl.innerHTML = "";
      // nextSteps placeholder set above as HTML
      reqMsg.style.display = "none";
      ptypeWarn.style.display = "none";
      const ra = document.getElementById("resultActions"); if (ra) ra.style.display = "none";
      updateProgressiveDisclosure();
      syncSelectedLabels();
	  
	  // Clear persisted assessment state
		try {
		  localStorage.removeItem('i4_calc_result');
		} catch (e) {
		  console.warn('Failed to clear persisted assessment state', e);
		}
		
		// Reset in-memory state
		window.assessmentState = {
		  productionType: null,
		  overallScore: null,
		  maturityLevel: null,
		  domainScores: null,
		  answersRaw: null,
		  roadmapText: null
		};

}

    
    function buildAnswersRaw() {
      const pairs = [];
      for (let i = 1; i <= 20; i++) {
        const picked = document.querySelector(`input[name="q${i}"]:checked`);
        if (picked) pairs.push(`q${i}=${picked.value}`);
      }
      return pairs.join(",");
    }

function buildCopyText() {
      const effectiveType = getProductionTypeEffective();
      const rawType = getProductionTypeRaw();

      const { total, domainScores } = getScores();
      const pct = Math.round((total / MAX_TOTAL) * 100);

      const parts = [];
      parts.push("Industrial Digitalization Calculator");
      parts.push(`Production type: ${rawType || "not selected"} (effective: ${effectiveType || "n/a"})`);
      parts.push(`Overall: ${pct}%`);
      parts.push(`Level: ${overallLevelFromPercent(pct)}`);
      parts.push("Domain breakdown:");
      domains.forEach(d => {
        const score = domainScores[d.key];
        const p = pctOf(score, d.max);
        parts.push(`- ${d.name}: ${p}%`);
      });

      if (effectiveType) {
        parts.push("Recommended next steps:");
        parts.push(sanitizeRoadmapText(buildRoadmapText(domainScores, effectiveType)));
      } else {
        parts.push("Recommended next steps:");
        parts.push("Select a production type and recalculate to get the roadmap.");
      }

      return parts.join("\n");
    }


    
    // Progressive disclosure by section (visual dimming)
    const sectionDefs = [
      { idx: 1, q: [1, 2, 3] },
      { idx: 2, q: [4, 5, 6, 7] },
      { idx: 3, q: [8, 9, 10] },
      { idx: 4, q: [11, 12, 13] },
      { idx: 5, q: [14, 15] },
      { idx: 6, q: [16, 17] },
      { idx: 7, q: [18, 19, 20] },
    ];

    const sections = sectionDefs
      .map(s => document.querySelector(`details.section[data-section="${s.idx}"]`))
      .filter(Boolean);

    function isQuestionAnswered(qn) {
      return !!document.querySelector(`input[name="q${qn}"]:checked`);
    }

    function isSectionComplete(sectionIdx) {
      const def = sectionDefs.find(d => d.idx === sectionIdx);
      if (!def) return false;
      return def.q.every(isQuestionAnswered);
    }

    function firstIncompleteSectionIdx() {
      for (const def of sectionDefs) {
        if (!isSectionComplete(def.idx)) return def.idx;
      }
      return sectionDefs[sectionDefs.length - 1].idx + 1;
    }

    function setSectionState(sectionEl, state) {
      sectionEl.classList.remove("locked", "active", "completed");
      if (state) sectionEl.classList.add(state);
    }

    function lockSection(sectionEl) {
      setSectionState(sectionEl, "locked");
      sectionEl.open = false;
    }

    function unlockSection(sectionEl, state) {
      setSectionState(sectionEl, state);
    }

    function updateProgressiveDisclosure() {
      const firstIncomplete = firstIncompleteSectionIdx();

      sections.forEach(sec => {
        const idx = Number(sec.getAttribute("data-section"));

        if (idx < firstIncomplete) {
          unlockSection(sec, "completed");
          return;
        }

        if (idx === firstIncomplete) {
          unlockSection(sec, "active");
          sec.open = true;
          return;
        }

        lockSection(sec);
      });

      if (firstIncomplete > sectionDefs[sectionDefs.length - 1].idx) {
        sections.forEach(sec => {
          unlockSection(sec, "completed");
        });
      }
    }

    // Prevent opening locked sections
    sections.forEach(sec => {
      const summary = sec.querySelector("summary");
      if (!summary) return;
      summary.addEventListener("click", (e) => {
        if (sec.classList.contains("locked")) {
          e.preventDefault();
        }
      });
    });

document.addEventListener("change", (e) => {
      // Any answer change should immediately update progress and progressive disclosure.
      if (e.target && e.target.matches('input[type="radio"]')) {
        updateProgress();
        updateProgressiveDisclosure();
      syncSelectedLabels();
}
    });
calcBtn.addEventListener("click", calculate);
    resetBtn.addEventListener("click", resetAll);

    updateProgress();

    // Ensure clean state on hard refresh
    window.addEventListener("load", () => {
      document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);
      updateProgress();
      updateProgressiveDisclosure();
      syncSelectedLabels();
    });
  
    function copyResults() {
      const btn = document.activeElement;
      const text = buildCopyText();
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      if (btn && btn.tagName === "BUTTON") {
        const original = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = original, 1200);
      }
    }

    function printResults() {
      window.print();
    }
  
  
  document.addEventListener("DOMContentLoaded", () => {
const discussBtn = document.getElementById("discussBtn");
  const modal = document.getElementById("discussModal");
  const backdrop = document.getElementById("modalBackdrop");
  const closeBtn = document.getElementById("modalClose");
  const shareBtn = document.getElementById("shareBtn");
  const shareError = document.getElementById("shareError");

  function openModal() {
    modal.style.display = "block";
    backdrop.style.display = "block";
    document.body.style.overflow = "hidden";
  }

  function closeModal() {
    modal.style.display = "none";
    backdrop.style.display = "none";
    document.body.style.overflow = "";
    shareBtn.disabled = false;
    shareBtn.textContent = "Share";
    shareError.style.display = "none";
  }

  if (discussBtn) {
    discussBtn.addEventListener("click", openModal);
  }

  backdrop.addEventListener("click", closeModal);
  closeBtn.addEventListener("click", closeModal);

  async function sendToZapierForm(fields) {
    const params = new URLSearchParams();
    Object.entries(fields).forEach(([k, v]) => {
      if (v === undefined || v === null) return;
      params.set(k, String(v));
    });

    return fetch("https://hooks.zapier.com/hooks/catch/19492636/ul8d3l4/", {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
      body: params.toString()
    });
  }

  shareBtn.addEventListener("click", async () => {
    const name = document.getElementById("inpName").value.trim();
    const company = document.getElementById("inpCompany").value.trim();
    const email = document.getElementById("inpEmail").value.trim();
    const lan = document.getElementById("inpLan").checked;

    if (!name || !company || !email) {
      shareError.style.display = "block";
      return;
    }

    shareBtn.disabled = true;
    shareBtn.textContent = "Sent!";
    shareError.style.display = "none";

    const s = window.assessmentState || {};

    if (s.overallScore === null || s.overallScore === undefined) {
      shareBtn.disabled = false;
      shareBtn.textContent = "Share";
      shareError.textContent = "Please click Calculate first.";
      shareError.style.display = "block";
      return;
    }

    const fields = {
      source: "digitalization_calculator",
      build_version: "0.7.6",
      timestamp: new Date().toISOString(),

      name,
      company,
      email,
      lan_available: lan ? "Yes" : "No",

      production_type: s.productionType || "",
      overall_score: s.overallScore,
      maturity_level: s.maturityLevel || "",

      domain_planning: (s.domainScores && s.domainScores.planning !== undefined) ? s.domainScores.planning : "",
      domain_maintenance: (s.domainScores && s.domainScores.maintenance !== undefined) ? s.domainScores.maintenance : "",
      domain_quality: (s.domainScores && s.domainScores.quality !== undefined) ? s.domainScores.quality : "",
      domain_warehouse: (s.domainScores && s.domainScores.warehouse !== undefined) ? s.domainScores.warehouse : "",
      domain_energy: (s.domainScores && s.domainScores.energy !== undefined) ? s.domainScores.energy : "",
      domain_safety: (s.domainScores && s.domainScores.safety !== undefined) ? s.domainScores.safety : "",
      domain_data: (s.domainScores && s.domainScores.data !== undefined) ? s.domainScores.data : "",

      answers_raw: s.answersRaw || "",
      recommended_roadmap: s.roadmapText || ""
    };

    try {
      await sendToZapierForm(fields);
      setTimeout(closeModal, 5000);
    } catch (e) {
      shareBtn.disabled = false;
      shareBtn.textContent = "Share";
      shareError.textContent = "Something went wrong. Please try again.";
      shareError.style.display = "block";
    }
  });
  });

  // Global assessment state
  window.assessmentState = {
    productionType: null,
    overallScore: null,
    maturityLevel: null,
    domainScores: null,
    answersRaw: null,
    roadmapText: null
  };

(function restoreAssessmentState() {
  try {
    const raw = localStorage.getItem('i4_calc_result');
    if (!raw) return;

    const saved = JSON.parse(raw);
    if (!saved || saved.overallScore == null) return;

    window.assessmentState = saved;

  } catch (e) {
    console.warn('Failed to restore assessment state', e);
  }
})();

  function canDiscussResults() {
    return (
      window.assessmentState &&
      window.assessmentState.productionType &&
      window.assessmentState.overallScore !== null
    );
  }

</script>

  <div style="text-align:center; color:#aaa; font-size:11px; padding:18px 0;">
   Powered by MDCplus | Build v0.7.6.2
  </div>


<div id="modalBackdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:999;"></div>

<div id="discussModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#fff; width:90%; max-width:460px; border-radius:12px; padding:20px; z-index:1000;">
  <button id="modalClose" style="background:none;border:none;font-size:18px;position:absolute;top:12px;right:12px;color:#000;cursor:pointer;">Ã—</button>
  <h2 style="margin-top:0;">Review your digitalization results</h2>
  <p class="muted">Share your contact details and weâ€™ll review your results and suggest practical next steps.</p>

  <div style="display:grid;gap:10px;">
    <input id="inpName" placeholder="Name *" />
    <input id="inpCompany" placeholder="Company *" />
    <input id="inpEmail" placeholder="Work email *" />
    <label style="font-size:13px;">
      <input type="checkbox" id="inpLan" /> Factory has LAN network
    </label>
  </div>

  <button id="shareBtn" class="primary" style="margin-top:14px;width:100%;">Share</button>
  <div id="shareError" style="display:none;color:#b00020;font-size:12px;margin-top:8px;">
    Something went wrong. Please try again.
  </div>

  <div style="font-size:11px;color:#666;margin-top:14px;line-height:1.4;">
    We only use your data to review your results and follow up on this request.
    Your information is not stored on this website.
  </div>
</div>




<script>
document.addEventListener('DOMContentLoaded', function () {
  const actions = document.getElementById("resultsActions");
	if (actions) actions.style.display = "none";
  const calcBtn = document.getElementById('calcBtn');
  const resetBtn = document.getElementById('resetBtn');

  function isVisible(el) {
    if (!el) return false;
    const cs = window.getComputedStyle(el);
    return cs.display !== 'none' && cs.visibility !== 'hidden' && cs.opacity !== '0';
  }

  function shouldShowActions() {
    // Show only when the Calculate action is successful:
    // - production type selected (ptypeWarn not visible)
    // - at least one question answered (reqMsg not visible)
    const reqMsg = document.getElementById('reqMsg');
    const ptypeWarn = document.getElementById('ptypeWarn');
    return !isVisible(reqMsg) && !isVisible(ptypeWarn);
  }

  if (calcBtn && actions) {
    calcBtn.addEventListener('click', () => {
      // Let existing validation and rendering run first
      setTimeout(() => {
        if (shouldShowActions()) {
          actions.style.display = 'block';
        } else {
          actions.style.display = 'none';
        }
      }, 0);
    });
  }

  if (resetBtn && actions) {
    resetBtn.addEventListener('click', () => {
      actions.style.display = 'none';
    });
  }


  const copyBtn = document.getElementById('copyBtn');
  if (copyBtn) {
    copyBtn.addEventListener('click', () => {
      try { track('results_copied', { production_type: window.assessmentState?.productionType || 'unknown' }); } catch(e){}
    });
  }

  const printBtn = document.getElementById('printBtn');
  if (printBtn) {
    printBtn.addEventListener('click', () => {
      try { track('results_printed', { production_type: window.assessmentState?.productionType || 'unknown' }); } catch(e){}
    });
  }

  const contactBtn = document.getElementById('contactExpertBtn');
  if (contactBtn) {
    contactBtn.addEventListener('click', () => {
      try { track('contact_expert_opened', { production_type: window.assessmentState?.productionType || 'unknown' }); } catch(e){}
      // If you later wire a modal/webhook, do it here.
    });
  }
});
</script>



<script>
document.addEventListener('DOMContentLoaded', function () {

  const copyBtn = document.getElementById('copyBtn');
  if (copyBtn && typeof copyResults === 'function') copyBtn.onclick = copyResults;

  const printBtn = document.getElementById('printBtn');
  if (printBtn && typeof printResults === 'function') printBtn.onclick = printResults;

  const contactBtn = document.getElementById('contactExpertBtn');
  const modal = document.getElementById('discussModal');
  const backdrop = document.getElementById('modalBackdrop');
  if (contactBtn && modal && backdrop) {
    contactBtn.onclick = function () {
      modal.style.display = 'block';
      backdrop.style.display = 'block';
      document.body.style.overflow = 'hidden';
    };
  }

  const resetBtn = document.getElementById('resetBtn');
  const actions = document.getElementById('resultsActions');
  if (resetBtn && actions) {
    resetBtn.addEventListener('click', function () {
      actions.style.display = 'none';
    });
  }

const aiBtn = document.getElementById('aiDiscussBtn');
const aiInline = document.getElementById('aiInlineHelp');

if (aiBtn && aiInline) {
  aiBtn.addEventListener('click', () => {
    aiInline.style.display = 'block';

    try {
      track('ai_inline_shown', {
        production_type: window.assessmentState?.productionType || 'unknown'
      });
    } catch (e) {}

    aiInline.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
}


});
</script>

<!-- Zapier AI Chatbot Popup -->
<script async type="module"
  src="https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js">
</script>
<zapier-interfaces-chatbot-embed
  chatbot-id="cml50ztkd005dtsrvp9tsl8hb"
  is-popup="true">
</zapier-interfaces-chatbot-embed>



	
<!-- test -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('discussModal');
  const backdrop = document.getElementById('modalBackdrop');
  const closeBtn = document.getElementById('modalClose');

  function openContactModal() {
    if (!modal || !backdrop) return;

    modal.style.display = 'block';
    backdrop.style.display = 'block';
    document.body.style.overflow = 'hidden';

    try {
      track('contact_expert_opened', {
        source: 'hash',
        production_type: window.assessmentState?.productionType || 'unknown'
      });
    } catch (e) {}
  }

  function closeContactModal() {
    if (!modal || !backdrop) return;

    modal.style.display = 'none';
    backdrop.style.display = 'none';
    document.body.style.overflow = '';
  }

  const contactBtn = document.getElementById('contactExpertBtn');
  if (contactBtn) {
    contactBtn.addEventListener('click', openContactModal);
  }

  if (backdrop) backdrop.addEventListener('click', closeContactModal);
  if (closeBtn) closeBtn.addEventListener('click', closeContactModal);
	
  if (window.location.hash === '#contact') {
    setTimeout(openContactModal, 200);
  }
});
</script>
	
</body>
</html>


